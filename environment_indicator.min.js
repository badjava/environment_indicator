/**
 * @file
 * Environment info JavaScript.
 *
 * @author Tom Kirkpatrick (mrfelton), www.systemseed.com
 *
 * affectFavicon() originally written by James Andres for WhatSite.js
 * (https://github.com/jamesandres/WhatSite)
 */(function(e){Drupal.environmentIndicator=Drupal.environmentIndicator||{};Drupal.behaviors.environmentIndicator={attach:function(t,n){n.environment_indicator=e.extend({text:" ",color:"#d00c0c",suppress:!1,margin:!1,position:"left"},n.environment_indicator||{});if(n.environment_indicator.suppress)return;if(e("body:not(.environment-indicator-processed, .overlay)",t).length){n.environment_indicator.cssClass="environment-indicator-"+n.environment_indicator.position;var r=e("#environment-indicator",t);if(!r.length){e("body",t).prepend('<div id="environment-indicator">'+n.environment_indicator.text+"</div>");e("body",t).addClass(n.environment_indicator.cssClass);r.css("background-color",n.environment_indicator.color);r.html(r.text().replace(/(.)/g,"$1<br />"));if(n.environment_indicator.margin){e("body:not(.environment-indicator-adjust)",t).addClass("environment-indicator-adjust");e("#toolbar").length&&e("#toolbar").css("margin-"+n.environment_indicator.position,"10px")}}Drupal.environmentIndicator.affectFavicon(n.environment_indicator.color);e("body:not(.environment-indicator-processed)",t).addClass("environment-indicator-processed")}}};Drupal.environmentIndicator.affectFavicon=function(e){var t,n=document.getElementsByTagName("link"),r=null,i,s,o;for(t=n.length;t>=0;t-=1){if(typeof n[t]!="object")continue;i=n[t].getAttribute("rel");if(typeof i=="undefined")continue;if(i==="shortcut icon"||i==="icon"){r=n[t];break}}s=new Image;o=Drupal.environmentIndicator.splitColor(e).join(",");s.onload=function(){var e,t,n;e=document.createElement("canvas");e.setAttribute("width","16px");e.setAttribute("height","16px");t=e.getContext("2d");t.lineCap="butt";t.drawImage(s,0,0);t.beginPath();t.strokeStyle="rgba("+o+",1)";t.lineWidth=4;t.moveTo(0,0);t.lineTo(e.width,0);t.stroke();t.beginPath();t.strokeStyle="rgba(0,0,0,0.7)";t.lineWidth=1;t.moveTo(0,2.5);t.lineTo(e.width,2.5);t.stroke();try{(n=r.cloneNode(!0)).setAttribute("href",t.canvas.toDataURL());r.parentNode.replaceChild(n,r)}catch(i){}};s.src=r.href;return this};Drupal.environmentIndicator.splitColor=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}})(jQuery);