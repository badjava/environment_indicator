/**
 * @file
 * Environment info JavaScript.
 *
 * @author Tom Kirkpatrick (mrfelton), www.systemseed.com
 *
 * affectFavicon() originally written by James Andres for WhatSite.js
 * (https://github.com/jamesandres/WhatSite)
 */

(function(b){Drupal.environmentIndicator=Drupal.environmentIndicator||{};Drupal.behaviors.environmentIndicator={attach:function(d,a){a.environment_indicator=b.extend({text:" ",color:"#d00c0c",suppress:!1,margin:!1,position:"left"},a.environment_indicator||{});if(!a.environment_indicator.suppress&&b("body:not(.environment-indicator-processed, .overlay)",d).length){a.environment_indicator.cssClass="environment-indicator-"+a.environment_indicator.position;var e=b("#environment-indicator",d);e.length||
(b("body",d).prepend('<div id="environment-indicator">'+a.environment_indicator.text+"</div>"),b("body",d).addClass(a.environment_indicator.cssClass),e=b("#environment-indicator",d),e.css("background-color",a.environment_indicator.color),e.html(e.text().replace(/(.)/g,"$1<br />")),a.environment_indicator.margin&&(b("body:not(.environment-indicator-adjust)",d).addClass("environment-indicator-adjust"),b("#toolbar").length&&b("#toolbar").css("margin-"+a.environment_indicator.position,"10px")));Drupal.environmentIndicator.affectFavicon(a.environment_indicator.color);
b("body:not(.environment-indicator-processed)",d).addClass("environment-indicator-processed")}}};Drupal.environmentIndicator.affectFavicon=function(d){var a,b=document.getElementsByTagName("link"),f=null,g,h,j;for(a=b.length;0<=a;a-=1)if("object"===typeof b[a]&&(g=b[a].getAttribute("rel"),"undefined"!==typeof g&&("shortcut icon"===g||"icon"===g))){f=b[a];break}h=new Image;j=Drupal.environmentIndicator.splitColor(d).join(",");h.onload=function(){var a,c,b;a=document.createElement("canvas");a.setAttribute("width",
"16px");a.setAttribute("height","16px");c=a.getContext("2d");c.lineCap="butt";c.drawImage(h,0,0);c.beginPath();c.strokeStyle="rgba("+j+",1)";c.lineWidth=4;c.moveTo(0,0);c.lineTo(a.width,0);c.stroke();c.beginPath();c.strokeStyle="rgba(0,0,0,0.7)";c.lineWidth=1;c.moveTo(0,2.5);c.lineTo(a.width,2.5);c.stroke();try{(b=f.cloneNode(!0)).setAttribute("href",c.canvas.toDataURL()),f.parentNode.replaceChild(b,f)}catch(d){}};h.src=f.href;return this};Drupal.environmentIndicator.splitColor=function(b){return(b=
/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b))?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:null}})(jQuery);
